<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>실시간 퀴즈</title>

  <!-- 기존 스타일 유지 -->
  <link rel="stylesheet" href="./app.css" />

  <!-- ① Firebase compat (반드시 app.js보다 먼저) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
  <script>
    // 본인 Firebase 설정으로 교체
    const firebaseConfig = {
      apiKey: "AIzaSyCClNc95ykYCudmLHTPgpewZ60bZ8zukbo",
      authDomain: "live-quiz-a14d1.firebaseapp.com",
      projectId: "live-quiz-a14d1",
    };
    firebase.initializeApp(firebaseConfig);
    window.db = firebase.firestore();

    // Firestore compat → 간단 래퍼(모듈식처럼 사용)
    window.FS = {
      doc: (...path) => {
        let ref = window.db;
        for (let i = 0; i < path.length; i += 2) {
          const col = path[i], id = path[i + 1];
          ref = ref.collection(col);
          if (id) ref = ref.doc(id);
        }
        return ref;
      },
      setDoc: (ref, data, opt) => opt?.merge ? ref.set(data, { merge: true }) : ref.set(data),
      updateDoc: (ref, data) => ref.update(data),
      getDoc: (ref) => ref.get(),
      onSnapshot: (ref, cb) => ref.onSnapshot(cb),
      serverTimestamp: () => firebase.firestore.FieldValue.serverTimestamp(),
      runTransaction: (db, fn) => window.db.runTransaction(fn),
    };

    // URL(role, room) → body data attribute 세팅 (디자인 영향 없음)
    (function () {
      const u = new URL(location.href);
      const role = (u.searchParams.get('role') || 'admin').toLowerCase();
      const room = u.searchParams.get('room') || '';
      document.documentElement.setAttribute('data-role', role); // CSS 제어용
      document.documentElement.setAttribute('data-room', room);
    })();
  </script>

  <!-- ② QR 코드 라이브러리 (반드시 app.js보다 먼저) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>

<body>
  <!-- ----------------------------------------------------------------
       ⬇⬇⬇  기존의 HTML 레이아웃을 그대로 사용하세요 (변경 금지)  ⬇⬇⬇
       - 상단 메뉴, 문항/옵션/프레젠테이션/결과 탭, 입력창 등
       - QR 캔버스: <canvas id="qrCanvas"></canvas>
       - 학생 링크 입력창: <input id="studentLink" ...>
       - 학생 화면 제출 버튼: id="btnSubmit"
       - 내 결과 보기 버튼: id="btnMyResult"
       ---------------------------------------------------------------- -->

  <!-- 예시로 필요한 최소 id만 적어 둡니다. (당신의 기존 마크업 유지) -->
  <!-- QR/링크 영역(옵션 탭에 존재) -->
  <div class="admin-only">
    <canvas id="qrCanvas" width="220" height="220"></canvas>
    <input id="studentLink" class="link-input" readonly />
    <button id="btnOpenStudent" type="button">열기</button>
  </div>

  <!-- 프레젠테이션 영역의 안내 문구 -->
  <div id="presHint" class="admin-only pres-hint">시작 버튼을 누르면 문항이 제시됩니다.</div>

  <!-- 학생 화면: 보기/주관식/제출/내결과 영역(기존 디자인 유지) -->
  <div id="studentPanel" class="student-only">
    <div id="studentNotice" class="student-notice">참가 완료! 교사가 시작하면 1번 문항이 표시됩니다.</div>

    <!-- 선택형 보기 버튼 컨테이너 -->
    <div id="choiceWrap"></div>
    <!-- 주관식 입력 -->
    <input id="shortAnswer" class="sa" placeholder="정답을 입력하세요" />
    <!-- 제출 버튼 -->
    <button id="btnSubmit" class="primary">제출</button>

    <!-- 종료 후 노출되는 개인 결과 보기 -->
    <div id="endedWrap" class="ended-wrap">
      <p class="ended-text">퀴즈가 종료되었습니다!</p>
      <button id="btnMyResult" type="button">내 결과 보기</button>
    </div>
  </div>

  <!-- ③ 앱 스크립트 (항상 마지막, 단 한 번) -->
  <script src="./app.js"></script>
</body>
</html>
