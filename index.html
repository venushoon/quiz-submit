<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>실시간 퀴즈</title>

  <!-- 기본 스타일 + 보강 -->
  <link rel="stylesheet" href="app.css" />
  <style>
    html.student .admin-only{display:none!important}
    .active{outline:2px solid #5b8cff}
  </style>

  <!-- Firebase compat (반드시 app.js보다 먼저) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- QRCode (옵션 탭 QR) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>

  <!-- ===== 상단(세션/탭) ===== -->
  <header class="admin-only">
    <input id="sessionInput" type="text" placeholder="클래스(세션) 입력" />
    <button id="btnConnect">접속</button>
    <button id="btnLogout">세션아웃</button>
    <span id="statusLabel">세션: - · 오프라인</span>

    <nav>
      <button class="admin-only" id="tabQ">① 문항</button>
      <button class="admin-only" id="tabOpt">② 옵션</button>
      <button class="admin-only" id="tabPres">③ 프레젠테이션</button>
      <button class="admin-only" id="tabRes">④ 결과</button>
    </nav>
  </header>

  <!-- ===== 문항 탭 ===== -->
  <section class="admin-only" id="panelQuestions">
    <h2>수동 출제 가이드</h2>
    <div class="guide-box">
      <ul>
        <li>객관식: 문항, 보기1~4, 정답번호(숫자)</li>
        <li>주관식: 문항, 주관식, 정답텍스트</li>
        <li>예) 가장 큰 행성?, 지구, 목성, 화성, 금성, 2</li>
        <li>문항 옆 이미지 업로드로 그림 포함 가능</li>
      </ul>
    </div>

    <div class="q-form">
      <input id="quizTitle" placeholder="퀴즈 제목" value="샘플 퀴즈" />
      <input id="quizCount" type="number" min="1" value="3" />
      <button id="btnBlank"   type="button">빈폼</button>
      <button id="btnSample"  type="button">샘플</button>
      <button id="btnSaveForm"type="button">저장</button>
      <button id="btnUpload"  type="button">업로드</button>
      <button id="btnTemplate"type="button">샘플양식</button>
    </div>
  </section>

  <!-- ===== 옵션 탭 ===== -->
  <section class="admin-only" id="panelOptions">
    <h2>제출 정책 & 진행</h2>
    <div>
      <label><input type="radio" name="once" checked /> 기기당 1회</label>
      <label><input type="radio" name="once" /> 실명당 1회</label>
      <div>
        <label><input type="checkbox" id="chkAllow" checked /> 제출 허용</label>
        <label><input type="checkbox" id="chkResult" /> 결과 공개</label>
        <label><input type="checkbox" id="chkBright" /> 프레젠테이션 밝은 모드</label>
      </div>
      <div class="timer-row">
        <label>타이머(초): <input id="timerSec" type="number" min="0" value="30" /></label>
        <button id="btnTimerStart" type="button">타이머 시작</button>
        <button id="btnTimerStop"  type="button">타이머 정지</button>
        <span id="timerView">00:00</span>
      </div>
      <button id="btnOptSave" type="button">저장</button>
      <button id="btnResetAll" type="button">초기화</button>
    </div>

    <h2>학생용 접속</h2>
    <div class="qr-box">
      <canvas id="qrCanvas" width="200" height="200"></canvas>
      <div>
        <input id="studentUrl" readonly />
        <button id="btnCopy" type="button">복사</button>
        <button id="btnOpenStudent" type="button">열기</button>
      </div>
      <small>※ 옵션 저장 후 QR/링크가 갱신됩니다.</small>
    </div>
  </section>

  <!-- ===== 프레젠테이션 탭 ===== -->
  <section class="admin-only" id="panelPresentation">
    <div class="toolbar">
      <button id="btnStart" type="button">시작</button>
      <button id="btnPrev"  type="button">이전</button>
      <button id="btnNext"  type="button">다음</button>
      <button id="btnEnd"   type="button">종료</button>
      <span id="badgeIndex">Q0/0</span>
      <span id="badgeClock">00:00</span>
    </div>
    <article class="stage">
      <h2 id="pTitle">시작 버튼을 누르면 문항이 제시됩니다.</h2>
      <p id="pStem"></p>
      <img id="pImg" alt="" style="display:none;max-width:480px" />
      <div class="options">
        <button class="pOption"></button>
        <button class="pOption"></button>
        <button class="pOption"></button>
        <button class="pOption"></button>
      </div>
    </article>
  </section>

  <!-- ===== 결과 탭 ===== -->
  <section class="admin-only" id="panelResult">
    <div class="result-toolbar">
      <button id="btnExport" type="button">CSV 내보내기</button>
      <button id="btnLeaderboard" type="button">리더보드 전용 화면</button>
    </div>
    <div id="leaderboard" class="board"></div>
  </section>

  <!-- ===== 학생 전용 UI ===== -->
  <main id="studentPanel">
    <div id="joinModal" class="student-modal" style="display:none">
      <h3>세션 접속 필요</h3>
      <input id="joinName" placeholder="이름 또는 번호를 입력하세요!" />
      <button id="btnJoin" type="button">참가</button>
    </div>

    <div id="sWait" class="student-wait" style="display:none">참가 완료! 교사가 시작하면 1번 문항이 표시됩니다.</div>

    <section id="sQWrap" class="student-quiz" style="display:none">
      <h2 id="sTitle">퀴즈</h2>
      <p id="sStem"></p>
      <img id="sImg" alt="" style="display:none;max-width:480px" />
      <div class="options">
        <button class="sOption"></button>
        <button class="sOption"></button>
        <button class="sOption"></button>
        <button class="sOption"></button>
      </div>
      <input id="sAnswer" placeholder="정답을 입력하세요" style="display:none" />
      <button id="sSubmit" type="button">제출</button>
    </section>

    <section id="sEnded" class="student-ended" style="display:none">
      <p>퀴즈가 종료되었습니다!</p>
      <button id="btnMyResult" type="button">내 결과 보기</button>
    </section>
  </main>

  <script src="app.js"></script>
</body>
</html>
