<!doctype html>
<html lang="ko">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>실시간 퀴즈</title>

    <style>
      :root {
        --bg:#0e1621; --panel:#121c28; --muted:#7f9bb3; --text:#e8f0f7;
        --brand:#5a6cff; --accent:#6ae3ff; --danger:#ff6b6b; --ok:#4ade80;
        --bd:#223246; --chip:#192638;
      }
      html,body {margin:0; height:100%; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans KR", "Apple SD Gothic Neo", sans-serif;}
      .container {max-width:1100px; margin:0 auto; padding:24px;}
      h1 {font-size:28px; margin:0 0 12px;}
      .row {display:flex; align-items:center; gap:8px; flex-wrap:wrap;}
      .panel {background:var(--panel); border:1px solid var(--bd); border-radius:16px; padding:16px;}
      .grid {display:grid; gap:16px;}
      @media (min-width: 980px){ .grid-2 {grid-template-columns: 1.2fr 1fr;} }

      input,textarea,select,button {
        background:#0b1220; color:var(--text); border:1px solid var(--bd);
        border-radius:10px; padding:10px 12px; outline:none;
      }
      input::placeholder, textarea::placeholder {color:#92a6bb90;}
      input:focus, textarea:focus, select:focus {box-shadow:0 0 0 2px #5a6cff55; border-color:#5a6cff;}
      .btn {cursor:pointer; background:var(--brand); border:none; color:#fff; padding:10px 14px; border-radius:12px; font-weight:600}
      .btn.ghost {background:#0b1220;}
      .btn.ok {background:var(--ok); color:#07210f}
      .btn.danger {background:var(--danger)}
      .muted {color:var(--muted)}
      .chip {background:var(--chip); border:1px solid var(--bd); padding:6px 10px; border-radius:999px; font-size:12px;}
      .badge {background:#1b2a3c; border:1px solid var(--bd); padding:3px 8px; border-radius:8px; color:#a6c0da;}

      .toolbar {gap:8px; margin:12px 0}
      .field {display:flex; gap:8px; width:100%;}
      .field > * {flex:1}
      .section-title {display:flex; align-items:center; justify-content:space-between; margin-bottom:8px}
      .hint {font-size:12px; color:var(--muted)}
      .hidden {display:none !important;}
      .qr-wrap {background:#0b1220; border:1px dashed var(--bd); border-radius:12px; display:grid; place-items:center; height:220px;}
      .tabs {display:flex; gap:8px; margin:10px 0 16px;}
      .tab {padding:8px 14px; border-radius:10px; border:1px solid var(--bd); background:#0b1220; cursor:pointer;}
      .tab.active {background:var(--brand); color:#fff; border-color:transparent;}
      table {width:100%; border-collapse:collapse; font-size:14px;}
      th, td {border-bottom:1px solid var(--bd); padding:10px; text-align:left;}
      th {color:#a6c0da; font-weight:600;}
      .option {padding:10px 12px; border:1px solid var(--bd); background:#0b1220; border-radius:12px; cursor:pointer; text-align:left;}
      .option.selected {outline:2px solid var(--accent);}
      .option.correct {background:#0c2a16; border-color:#175f3a;}
      .option.wrong {background:#2a0c11; border-color:#6b1b27;}
    </style>

    <!-- QRCode (CDN) -->
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <!-- Firebase compat SDKs (v9) -->
    <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script defer src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <!-- App -->
    <script src="./app.js" type="module" defer></script>
  </head>
  <body>
    <div class="container">
      <h1>실시간 퀴즈</h1>

      <!-- 상단: 세션 연결 & 모드 전환 -->
      <div class="panel">
        <div class="row toolbar">
          <label class="badge">세션 코드</label>
          <input id="roomIdInput" placeholder="예: classA" style="max-width:220px" />
          <button id="btnConnect" class="btn">접속</button>
          <span id="statusText" class="muted">세션에 접속해 주세요.</span>
          <div style="flex:1"></div>
          <button id="btnTeacherMode" class="btn ghost">관리자</button>
          <button id="btnStudentMode" class="btn ghost">학생</button>
        </div>
      </div>

      <div class="grid grid-2" style="margin-top:16px">
        <main>
          <div class="tabs">
            <button class="tab active" data-tab="build">문항 만들기</button>
            <button class="tab" data-tab="control">진행</button>
            <button class="tab" data-tab="results">결과</button>
          </div>

          <!-- 관리자 패널 -->
          <section id="teacherPanel" class="panel">
            <!-- 문항 만들기 -->
            <div id="tab-build">
              <div class="section-title">
                <div class="row"><span class="badge">관리자 · 문항</span></div>
                <div class="row">
                  <button id="btnLoadSample" class="btn ghost">샘플 불러오기</button>
                  <button id="btnSaveQuiz" class="btn">저장</button>
                </div>
              </div>

              <div class="field" style="margin:8px 0">
                <input id="quizTitle" placeholder="퀴즈 제목" />
                <input id="questionCount" type="number" min="1" max="20" value="3" style="max-width:120px" />
                <button id="btnBuildForm" class="btn ghost">빈폼 만들기</button>
              </div>

              <div id="builder" class="grid" style="margin-top:8px"></div>
            </div>

            <!-- 진행 -->
            <div id="tab-control" class="hidden">
              <div class="section-title">
                <span class="badge">관리자 · 진행</span>
                <div class="row">
                  <label class="row" style="gap:6px">
                    <input type="checkbox" id="toggleAccept" />
                    <span class="muted">제출 허용</span>
                  </label>
                  <button id="btnStart" class="btn">시작</button>
                  <button id="btnPrev" class="btn ghost">이전</button>
                  <button id="btnNext" class="btn ghost">다음</button>
                  <button id="btnStop" class="btn danger">종료</button>
                </div>
              </div>

              <div class="panel" style="margin-top:8px">
                <div class="row" style="justify-content:space-between">
                  <div>
                    <div class="muted">현재 문항</div>
                    <div id="ctlQuestion" style="font-weight:700; margin-top:4px">-</div>
                  </div>
                  <div class="row" style="gap:8px">
                    <span class="chip">정답: <span id="chipOk">0</span></span>
                    <span class="chip">오답: <span id="chipNo">0</span></span>
                    <span class="chip">대기: <span id="chipWait">0</span></span>
                  </div>
                </div>

                <div id="chips" class="row" style="margin-top:10px; flex-wrap:wrap; gap:6px"></div>

                <div id="shortGrader" class="hidden" style="margin-top:10px">
                  <div class="muted" style="margin-bottom:6px">주관식 답안</div>
                  <div id="shortAnswers" class="grid"></div>
                </div>
              </div>
            </div>

            <!-- 결과 -->
            <div id="tab-results" class="hidden">
              <div class="row" style="justify-content:space-between">
                <span class="badge">관리자 · 결과</span>
                <div class="row">
                  <button id="btnExportCSV" class="btn ghost">CSV 내보내기</button>
                  <button id="btnResetAll" class="btn danger">전체 초기화</button>
                </div>
              </div>
              <div id="resultsContainer" class="panel" style="margin-top:10px; overflow:auto"></div>
            </div>
          </section>

          <!-- 학생 화면 -->
          <section id="studentPanel" class="panel hidden" style="margin-top:16px">
            <div class="row" style="justify-content:space-between">
              <span class="badge">학생</span>
              <span class="muted" id="progressText">0 / 0</span>
            </div>

            <div style="margin-top:8px; font-weight:700" id="questionText">대기 중입니다…</div>
            <div class="muted" id="quizTypeBadge" style="margin:4px 0 10px">대기</div>

            <div id="optionsContainer" class="grid" style="grid-template-columns:repeat(auto-fit,minmax(200px,1fr)); gap:8px"></div>

            <div id="subjectiveBox" class="hidden row" style="margin-top:8px">
              <input id="subjectiveInput" placeholder="답을 입력하세요" />
              <button id="btnSubmitSubjective" class="btn">제출</button>
            </div>

            <div class="row" style="margin-top:8px">
              <input id="studentName" placeholder="이름(또는 번호)" style="max-width:220px" />
              <button id="btnJoin" class="btn ghost">참가</button>
              <span id="answerState" class="muted"></span>
            </div>
          </section>
        </main>

        <!-- 오른쪽 사이드: QR & 링크 & 가이드 -->
        <aside class="grid" style="gap:16px">
          <section class="panel">
            <div class="section-title"><span class="badge">학생용 접속 QR</span></div>
            <div id="qrBox" class="qr-wrap"><div class="muted">QR 준비 중</div></div>
            <div class="row" style="margin-top:8px">
              <input id="studentLinkInput" placeholder="학생 접속 링크" />
              <button id="btnCopy" class="btn">링크 복사</button>
              <button id="btnOpenStudent" class="btn ghost">학생 모드로 열기</button>
            </div>
          </section>

          <section class="panel">
            <div class="section-title"><span class="badge">사용 가이드</span></div>
            <div class="muted" style="font-size:13px; line-height:1.45">
              <p>1) 관리자에서 <b>세션 코드</b> 입력 → <b>접속</b></p>
              <p>2) <b>문항 만들기</b>에서 문제를 작성 후 <b>저장</b></p>
              <p>3) <b>진행</b> 탭에서 <b>시작</b>, 필요 시 <b>제출 허용</b> 체크</p>
              <p>4) 학생은 QR/링크로 접속하여 <b>참가</b> → 답안 제출</p>
              <p>5) <b>결과</b> 탭에서 CSV로 내보내기 가능</p>
            </div>
          </section>
        </aside>
      </div>
    </div>
  </body>
</html>
