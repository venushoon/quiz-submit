<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>실시간 퀴즈</title>

  <!-- Firebase compat scripts (v9) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <!-- QR 코드 생성기 -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

  <link rel="stylesheet" href="app.css" />
</head>
<body>
  <header class="admin-only">
    <h1>실시간 퀴즈</h1>
    <input id="roomInput" type="text" placeholder="세션 코드 입력" />
    <button id="connectBtn">접속</button>
    <button id="disconnectBtn">세션아웃</button>
    <span id="sessionState">세션: - · 오프라인</span>

    <nav>
      <button id="tabQuestions">① 문항</button>
      <button id="tabOptions">② 옵션</button>
      <button id="tabPresentation">③ 프레젠테이션</button>
      <button id="tabResults">④ 결과</button>
    </nav>
  </header>

  <main>
    <!-- 문항 탭 -->
    <section id="questions" class="tab">
      <h2>수동 출제 가이드</h2>
      <ul>
        <li>객관식: 문항, 보기1~4, 정답번호(숫자)</li>
        <li>주관식: 문항, 주관식, 정답텍스트</li>
        <li>예) 가장 큰 행성?, 지구, 목성, 화성, 금성, 2</li>
        <li>문항 옆 <strong>이미지 업로드</strong>로 그림 포함 가능</li>
      </ul>
      <div>
        <input id="quizTitle" type="text" placeholder="퀴즈 제목" />
        <input id="quizCount" type="number" value="3" />
        <button id="btnBlank">빈폼</button>
        <button id="btnSample">샘플</button>
        <button id="btnSave">저장</button>
        <button id="btnUpload">업로드</button>
        <button id="btnTemplate">샘플양식</button>
      </div>
      <div id="questionList"></div>
    </section>

    <!-- 옵션 탭 -->
    <section id="options" class="tab hidden">
      <h2>제출 정책 & 진행</h2>
      <label><input type="radio" name="limit" value="device" checked> 기기당 1회</label>
      <label><input type="radio" name="limit" value="name"> 실명당 1회</label><br>
      <label><input type="checkbox" id="allowSubmit"> 제출 허용</label>
      <label><input type="checkbox" id="showResults"> 결과 공개</label>
      <label><input type="checkbox" id="brightMode"> 프레젠테이션 밝은 모드</label><br>
      타이머(초): <input id="timerInput" type="number" value="30" />
      <button id="btnSaveOptions">저장</button>
      <button id="btnReset">초기화</button>
      <div id="studentAccess">
        <h3>학생용 접속</h3>
        <canvas id="qrCanvas"></canvas>
        <input id="studentLink" readonly />
        <button id="btnCopy">복사</button>
        <button id="btnOpen">열기</button>
      </div>
    </section>

    <!-- 프레젠테이션 탭 -->
    <section id="presentation" class="tab hidden">
      <div id="controls">
        <button id="btnStart">시작</button>
        <button id="btnPrev">이전</button>
        <button id="btnNext">다음</button>
        <button id="btnEnd">종료</button>
        <span id="status">참가 0 | 제출 0 | 정답 0 | 오답 0 | Q0/0 | 00:00</span>
      </div>
      <div id="presentationView">
        <p id="waitMessage">시작 버튼을 누르면 문항이 제시됩니다.</p>
      </div>
    </section>

    <!-- 결과 탭 -->
    <section id="results" class="tab hidden">
      <button id="btnExport">CSV 내보내기</button>
      <button id="btnLeaderboard">리더보드 전용 화면</button>
      <table id="resultTable"></table>
    </section>

    <!-- 학생 전용 -->
    <section id="student" class="student-only hidden">
      <div id="joinModal">
        <h2>세션 접속 필요</h2>
        <input id="studentName" placeholder="이름 또는 번호를 입력하세요!" />
        <button id="btnJoin">참가</button>
      </div>
      <div id="studentWait" class="hidden">
        <p>참가 완료! 교사가 시작할 때까지 기다려주세요.</p>
      </div>
      <div id="studentQuiz" class="hidden">
        <h2 id="sQTitle"></h2>
        <img id="sQImg" class="hidden" />
        <div id="sOptBox"></div>
        <input id="sShortAnswer" class="hidden" placeholder="정답을 입력하세요" />
        <button id="sSubmit" class="hidden">제출</button>
      </div>
      <div id="studentResult" class="hidden">
        <p>퀴즈가 종료되었습니다!</p>
        <button id="btnMyResult">내 결과 보기</button>
      </div>
    </section>
  </main>

  <script>
    // Firebase 초기화 (반드시 본인 프로젝트 값으로 교체하세요)
    const firebaseConfig = {
      apiKey: "YOUR_API_KEY",
      authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
      projectId: "YOUR_PROJECT_ID",
      storageBucket: "YOUR_PROJECT_ID.appspot.com",
      messagingSenderId: "YOUR_SENDER_ID",
      appId: "YOUR_APP_ID"
    };
    firebase.initializeApp(firebaseConfig);
    window.db = firebase.firestore();
  </script>

  <script src="app.js"></script>
</body>
</html>
