<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>실시간 퀴즈</title>

  <!-- 기존 app.css(디자인) 그대로 사용 -->
  <link rel="stylesheet" href="./app.css" />
</head>
<body>
<!-- Firebase compat (반드시 app.js보다 먼저) -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
  // ✅ 여기에 본인의 Firebase 설정을 넣으세요
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT.firebaseapp.com",
    projectId: "YOUR_PROJECT_ID",
  };
  // 1) Firebase 초기화
  firebase.initializeApp(firebaseConfig);
  // 2) 전역 Firestore 핸들
  window.db = firebase.firestore();

  // 3) app.js가 모듈 문법 없이 사용할 수 있도록 간단한 compat 래퍼 제공
  //    - app.js는 아래 형태를 사용합니다: doc(window.db,"rooms",id) / collection(window.db,"rooms",id,"responses")
  window.FS = {
    doc: (dbOrFirst, ...rest) => {
      // (window.db,"rooms","class1") 또는 ("rooms","class1") 모두 지원
      let segments = [];
      if (typeof dbOrFirst === "string") {
        segments = [dbOrFirst, ...rest];
      } else {
        segments = rest;
      }
      let ref = window.db;
      for (let i = 0; i < segments.length; i += 2) {
        const col = segments[i];
        const id  = segments[i+1];
        ref = ref.collection(col);
        if (id) ref = ref.doc(id);
      }
      return ref;
    },
    collection: (_db, ...segs) => {
      let ref = window.db;
      for (let i = 0; i < segs.length; i++) ref = (i===0) ? ref.collection(segs[i]) : ref.doc(segs[i]);
      return ref; // app.js에서는 collection(window.db,"rooms",id,"responses")처럼 호출
    },
    setDoc     : (ref, data, opt) => (opt?.merge ? ref.set(data, {merge:true}) : ref.set(data)),
    getDoc     : (ref) => ref.get(),
    getDocs    : (ref) => ref.get(),
    onSnapshot : (ref, cb) => ref.onSnapshot(cb),
    updateDoc  : (ref, data) => ref.update(data),
    runTransaction: (_db, fn) => window.db.runTransaction(fn),
    serverTimestamp: () => firebase.firestore.FieldValue.serverTimestamp(),
  };
</script>

<!-- QR 코드 (반드시 app.js보다 먼저) -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>

<!-- 앱 스크립트 (항상 마지막, 단 한 번만 포함) -->
<script src="./app.js"></script>
</body>
</html>
