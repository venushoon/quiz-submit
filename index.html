<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>실시간 퀴즈 (관리자 · 학생)</title>
<style>
  :root {
    --bg:#0b1220; --panel:#111827; --panel2:#0f172a; --border:#1f2937; 
    --text:#e5e7eb; --muted:#9ca3af;
    --primary:#6366f1; --primary-2:#4f46e5; --accent:#22d3ee;
    --ok:#10b981; --no:#ef4444; --warn:#f59e0b;
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);color:var(--text);
    font:17px/1.6 "Noto Sans KR",system-ui,sans-serif}
  h1{font-size:36px;margin:12px 0}
  h3{margin:10px 0}
  .wrap{max-width:1200px;margin:0 auto;padding:20px}
  .row{display:flex;align-items:center;gap:12px}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:16px}
  .hidden{display:none !important}
  input,textarea,button{font:inherit;color:inherit}
  input[type=text], input[type=number], textarea {
    background:var(--panel2); border:1px solid var(--border); color:var(--text);
    border-radius:12px; padding:12px 16px; font-size:16px;
  }
  input:focus, textarea:focus {outline:2px solid var(--accent)}
  .btn{background:var(--primary);color:#fff;border:0;
    border-radius:12px;padding:12px 20px;font-size:16px;
    cursor:pointer;transition:.15s}
  .btn:hover{background:var(--primary-2)}
  .btn.ghost{background:transparent;color:var(--text);
    border:1px solid var(--border)}
  .btn.small{padding:8px 14px;font-size:14px}
  .badge{display:inline-flex;align-items:center;
    background:#171f34;border:1px solid #223052;
    color:#f87171;padding:6px 14px;border-radius:24px;font-size:14px}
  .badge .dot{width:10px;height:10px;border-radius:50%;
    background:#ef4444;box-shadow:0 0 0 5px #ef44441f}
  .panel{background:var(--panel);border:1px solid var(--border);
    border-radius:16px;padding:20px}
  .option{display:block;width:100%;background:#0e162b;
    border:1px solid var(--border);padding:14px;
    border-radius:12px;cursor:pointer;font-size:16px}
  .option:hover{background:#0c1426}
  .option.selected{border-color:var(--accent)}
  .option.correct{background:#05251a;border-color:#0c7a55}
  .option.wrong{background:#2a0d0d;border-color:#b91c1c}
  .chip{display:inline-block;padding:6px 12px;margin:4px;
    background:#1f2937;border-radius:20px;font-size:14px}
  .chip.ok{border:1px solid #065f46}
  .chip.no{border:1px solid #7f1d1d}
  .timer{font-variant-numeric:tabular-nums;
    font-weight:700;letter-spacing:.5px;font-size:18px}
  .tabbar{display:flex;gap:8px;margin-bottom:10px}
  .tab{padding:10px 16px;border-radius:10px;cursor:pointer;
    background:var(--panel2);color:var(--muted);font-size:15px}
  .tab.active{background:#1a223a;color:#fff}
  .banner{margin:10px 0;padding:12px;border:1px dashed var(--warn);
    border-radius:12px;color:#fcd34d;font-size:15px}
</style>

<!-- Firebase compat v9 -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
<!-- QRCode -->
<script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
<div class="wrap">
  <div id="banner" class="banner hidden"></div>

  <div class="row">
    <span class="badge"><span class="dot"></span> LIVE</span>
    <div class="row" style="margin-left:auto">
      <label class="muted">세션 코드</label>
      <input id="roomIdInput" placeholder="예: classA"/>
      <button id="btnConnect" class="btn">접속</button>
      <button id="btnTeacherMode" class="btn ghost">관리자</button>
      <button id="btnStudentMode" class="btn ghost">학생</button>
    </div>
  </div>

  <h1>실시간 퀴즈</h1>
  <div id="statusText" class="muted">세션에 접속해 주세요.</div>

  <!-- 학생 모드 -->
  <div id="joinCard" class="panel row" style="margin-top:16px">
    <input id="studentName" placeholder="이름 입력"/>
    <button id="btnJoin" class="btn">참가</button>
  </div>

  <div id="studentQuiz" class="panel hidden" style="margin-top:16px">
    <div class="row">
      <span id="quizTypeBadge" class="badge">대기</span>
      <div id="progressText" class="muted">0 / 0</div>
      <div class="row" style="margin-left:auto">
        <span class="muted">남은 시간</span>
        <span id="countdown" class="timer">00:00</span>
      </div>
    </div>
    <h3 id="questionText">대기 중입니다…</h3>
    <div id="optionsContainer" style="display:grid;grid-template-columns:1fr 1fr;gap:10px"></div>
    <div id="subjectiveBox" class="hidden row" style="margin-top:10px">
      <input id="subjectiveInput" placeholder="정답 입력"/>
      <button id="btnSubmitSubjective" class="btn">제출</button>
    </div>
    <div id="answerState" class="muted" style="margin-top:8px"></div>
  </div>

  <!-- 관리자 모드 -->
  <div id="teacherPanel" class="hidden" style="margin-top:20px">
    <div class="tabbar">
      <button class="tab active" data-tab="build">문항 만들기</button>
      <button class="tab" data-tab="control">진행</button>
      <button class="tab" data-tab="results">결과</button>
    </div>
    <section id="tab-build" class="panel"> … (문항 만들기 코드 동일) … </section>
    <section id="tab-control" class="panel hidden">
      <div class="grid-2">
        <div class="panel">
          <div class="row">
            <button id="btnStart" class="btn">시작</button>
            <button id="btnPrev" class="btn ghost">이전</button>
            <button id="btnNext" class="btn">다음</button>
            <button id="btnStop" class="btn ghost">종료</button>
            <label><input id="toggleAccept" type="checkbox"/> 제출 허용</label>
            <label><input id="toggleReveal" type="checkbox"/> 결과 공개</label>
            <div class="row" style="margin-left:auto">현재: <span id="ctlQuestion">-</span></div>
          </div>
          <div class="row" style="margin-top:12px">
            <label>타이머(초)</label>
            <input id="timerSec" type="number" value="30" min="5" style="width:100px"/>
            <button id="btnTimerStart" class="btn small">타이머 시작</button>
            <button id="btnTimerStop" class="btn ghost small">정지</button>
            <div class="row" style="margin-left:auto">
              <span class="muted">남은 시간</span>
              <span id="teacherCountdown" class="timer">00:00</span>
            </div>
          </div>
        </div>
        <div class="panel">
          <div class="row">
            <canvas id="qrCanvas" width="160" height="160" style="background:#fff;border-radius:8px"></canvas>
            <div style="flex:1">
              <input id="studentLink" readonly/>
              <div class="row" style="margin-top:8px">
                <button id="btnCopyLink" class="btn small">링크 복사</button>
                <button id="btnOpenStudent" class="btn ghost small">학생 모드로 열기</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
    <section id="tab-results" class="panel hidden"> … (리더보드/CSV 등 동일) … </section>
  </div>
</div>

<script>
/* Firebase 설정 */
const firebaseConfig = {
  apiKey: "AIzaSyCClNc95ykYCudmLHTPgpewZ60bZ8zukbo",
  authDomain: "live-quiz-a14d1.firebaseapp.com",
  projectId: "live-quiz-a14d1",
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* QR코드 & 링크 */
function refreshStudentLink(roomId){
  const url = `${location.origin}${location.pathname}?room=${roomId}&mode=student`;
  document.getElementById('studentLink').value = url;
  QRCode.toCanvas(document.getElementById('qrCanvas'), url, {width:160}, err=>{
    if(err) console.error(err);
  });
}
/* … 나머지 JS 로직(모드 전환, 문항 저장, 제출, 결과, 리더보드 등)은 이전 코드와 동일하게 유지 … */
</script>
</body>
</html>
