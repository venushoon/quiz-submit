<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>실시간 퀴즈</title>
  <link rel="stylesheet" href="./app.css" />
  <!-- QRCode (canvas) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js" defer></script>
  <!-- Firebase v9 (모듈형 CDN) -->
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js"></script>
  <script type="module" src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js"></script>
</head>
<body>
  <header class="top">
    <div class="brand">실시간 퀴즈</div>

    <div class="room">
      <span class="pill live">LIVE</span>
      <label class="label">세션</label>
      <input id="roomId" class="input sm" placeholder="예: class1" />
      <button id="btnConnect" class="btn primary sm">접속</button>
      <button id="btnAdmin" class="btn dark sm" title="관리자 모드">관리자</button>
      <button id="btnStudent" class="btn dark sm" title="학생 모드">학생</button>
      <span id="roomStatus" class="hint">세션에 접속해 주세요.</span>
    </div>
  </header>

  <main class="grid">
    <!-- 좌측: 컨트롤/빌더/결과 -->
    <section>
      <div class="tabs">
        <button id="tabBuild" class="tab">문항 만들기</button>
        <button id="tabControl" class="tab success">진행</button>
        <button id="tabPresent" class="tab info">프레젠테이션</button>
        <button id="tabResults" class="tab warn">결과</button>
      </div>

      <!-- 빌더 -->
      <div id="panelBuild" class="card hide">
        <div class="row">
          <input id="quizTitle" class="input" placeholder="퀴즈 제목" />
          <input id="questionCount" class="input xs" type="number" min="1" max="20" value="3" />
          <button id="btnBuildForm" class="btn">빈 폼 만들기</button>
          <button id="btnLoadSample" class="btn">샘플 넣기</button>
          <button id="btnSaveQuiz" class="btn primary">저장</button>
        </div>
        <div id="builder" class="stack"></div>
      </div>

      <!-- 진행 -->
      <div id="panelControl" class="card">
        <div class="row wrap">
          <button id="btnStart" class="btn success">시작</button>
          <button id="btnPrev" class="btn">이전</button>
          <button id="btnNext" class="btn success">다음</button>

          <label class="switch">
            <input id="chkAccept" type="checkbox" />
            <span>제출 허용</span>
          </label>

          <label class="switch">
            <input id="chkReveal" type="checkbox" />
            <span>결과 공개</span>
          </label>

          <div class="row gap">
            <span class="hint">타이머(초)</span>
            <input id="timerSec" class="input xs" type="number" min="5" max="600" value="30" />
            <button id="btnTimerGo" class="btn info">타이머 시작</button>
            <button id="btnTimerStop" class="btn">타이머 정지</button>
            <span class="count" id="leftSec">00:00</span>
          </div>

          <button id="btnEndAll" class="btn warn">퀴즈 종료</button>
        </div>

        <div class="nowq row">
          <div>현재: <b id="nowQuestion">-</b></div>
          <div class="hint">진행 <span id="progress">0/0</span></div>
        </div>

        <div class="split">
          <div class="card">
            <h4>학생용 링크/QR</h4>
            <canvas id="qrCanvas" class="qr"></canvas>
            <div class="row">
              <input id="studentLink" class="input" readonly />
              <button id="btnCopyLink" class="btn">링크 복사</button>
              <button id="btnOpenStudent" class="btn primary">학생 화면 열기</button>
            </div>
          </div>

          <div class="card">
            <h4>제출 현황</h4>
            <div id="chips" class="chips"></div>
            <div id="shortAnswers" class="stack sm"></div>
          </div>
        </div>
      </div>

      <!-- 프레젠테이션 -->
      <div id="panelPresent" class="card hide">
        <div class="present">
          <div class="title" id="pTitle">-</div>
          <div class="qtext" id="pQ">대기 중…</div>
          <div class="opts" id="pOpts"></div>
          <div class="legend">
            <span class="dot ok"></span>정답자
            <span class="dot no"></span>오답자
            <span class="dot wait"></span>미제출
          </div>
        </div>
      </div>

      <!-- 결과 -->
      <div id="panelResults" class="card hide">
        <div class="row">
          <button id="btnExportCSV" class="btn">CSV 내보내기</button>
          <button id="btnResetAll" class="btn warn">전체 초기화</button>
          <button id="btnSaveJSON" class="btn">JSON 저장</button>
          <label class="btn">
            불러오기
            <input id="fileLoad" type="file" accept="application/json" hidden />
          </label>
        </div>
        <div id="resultsTable" class="tablewrap"></div>
      </div>

      <!-- 학생 UI(같은 페이지에서 확인용) -->
      <div id="studentPanel" class="card hide">
        <div class="row">
          <input id="studentName" class="input" placeholder="이름(번호)" />
          <button id="btnJoin" class="btn primary">참가</button>
        </div>

        <div id="studentQ" class="stack">
          <div class="hint" id="badgeType">대기</div>
          <div class="qtext" id="sQText">대기 중입니다…</div>
          <div id="mcqBox" class="opts"></div>
          <div id="shortBox" class="row hide">
            <input id="shortInput" class="input" placeholder="정답 입력" />
            <button id="btnShortSend" class="btn success">제출</button>
          </div>
          <div class="hint" id="answerState"></div>
        </div>
      </div>
    </section>

    <!-- 우측: 가이드 -->
    <aside>
      <div id="guideAdmin" class="guide">
        <h4>📘 교사용 가이드</h4>
        <ul>
          <li>세션코드 입력 → <b>접속</b> (다음부터 자동 재접속)</li>
          <li><b>문항 만들기</b>에서 문항 작성 → <b>저장</b></li>
          <li><b>진행</b> 탭: <b>시작</b> → <b>제출 허용</b> 체크</li>
          <li>타이머 사용 시 종료 후 자동 제출 막기/자동 다음(옵션)</li>
          <li>골든벨 ON: 오답자 자동 탈락</li>
          <li><b>프레젠테이션</b> 탭: 화면으로 학생들과 함께 보기</li>
          <li><b>결과</b> 탭: 채점/CSV/JSON 저장, 전체 초기화</li>
        </ul>
      </div>

      <div id="guideStudent" class="guide hide">
        <h4>🦊 학생 가이드</h4>
        <ul>
          <li>링크/QR 접속 → 이름 입력 → <b>참가</b></li>
          <li>문제 화면에서 보기를 선택 후 <b>제출</b></li>
          <li>골든벨 ON: 오답 시 탈락</li>
        </ul>
      </div>
    </aside>
  </main>

  <footer class="foot">Made for classroom · 동기화/저장은 Firestore</footer>

  <script type="module" src="./app.js"></script>
</body>
</html>
