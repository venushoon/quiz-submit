<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>실시간 퀴즈</title>

  <!-- 스타일 -->
  <link rel="stylesheet" href="./app.css" />

  <!-- QRCode (전역 QRCode) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
</head>
<body>
  <!-- ===== 상단 바(기존 배치 유지) ===== -->
  <header class="topbar">
    <div class="left">
      <span class="pill red">LIVE</span>
      <span class="label">세션</span>
      <input id="roomId" class="input" placeholder="예: class1" />
      <button id="btnConnect" class="btn primary">접속</button>
      <span id="roomStatus" class="pill gray">오프라인</span>
    </div>
    <div class="right">
      <button id="btnAdmin" class="btn ghost">관리자</button>
      <button id="btnStudent" class="btn ghost">학생</button>
    </div>
  </header>

  <main class="container">
    <h1 class="title">실시간 퀴즈</h1>
    <p class="subtitle" id="statusText">세션에 접속해 주세요.</p>

    <!-- 탭 -->
    <nav class="tabs">
      <button id="tabBuild" class="tab active">문항 만들기</button>
      <button id="tabControl" class="tab">진행</button>
      <button id="tabPresent" class="tab">프레젠테이션</button>
      <button id="tabResults" class="tab">결과</button>
    </nav>

    <!-- 문항 만들기 -->
    <section id="panelBuild" class="card">
      <div class="row wrap gap">
        <input id="quizTitle" class="input grow" placeholder="퀴즈 제목" />
        <input id="questionCount" class="input w-120" type="number" min="1" max="20" value="3" />
        <button id="btnBuildForm" class="btn ghost">빈폼 만들기</button>
        <button id="btnLoadSample" class="btn ghost">샘플 불러오기</button>
        <button id="btnSaveQuiz" class="btn primary">저장</button>
      </div>
      <div id="builder" class="stack gap"></div>
    </section>

    <!-- 진행 -->
    <section id="panelControl" class="card hidden">
      <div class="grid-2 gap">
        <div class="stack gap">
          <div class="row gap">
            <button id="btnStart" class="btn success">시작</button>
            <button id="btnPrev" class="btn ghost">이전</button>
            <button id="btnNext" class="btn ghost">다음</button>
            <button id="btnEndAll" class="btn danger">종료</button>
            <span class="muted">현재: <b id="nowQuestion">-</b></span>
          </div>

          <div class="row gap">
            <label class="row gap-sm">
              <input id="chkAccept" type="checkbox" />
              <span>제출 허용</span>
            </label>
            <label class="row gap-sm">
              정책
              <select id="policySelect" class="input w-160">
                <option value="device-1" selected>기기당 1회</option>
                <option value="name-1">실명당 1회</option>
              </select>
            </label>
            <label class="row gap-sm">
              <input id="autoNextToggle" type="checkbox" />
              <span>자동 다음</span>
            </label>
          </div>

          <div class="row gap">
            <label class="row gap-sm">타이머(초)
              <input id="timerSec" class="input w-100" type="number" min="5" value="30"/>
            </label>
            <button id="btnTimerGo" class="btn ghost">타이머 시작</button>
            <button id="btnTimerStop" class="btn ghost">타이머 정지</button>
            <span class="muted">남은 시간 <b id="leftSec">00:00</b></span>
          </div>

          <div class="progress row gap">
            <span class="muted">진행</span><b id="progress">0/0</b>
          </div>

          <div>
            <h4>제출 현황</h4>
            <div id="chips" class="chips"></div>
            <div id="shortAnswers" class="stack gap"></div>
          </div>
        </div>

        <div class="stack gap">
          <h3 class="section-title">학생용 접속 QR</h3>
          <canvas id="qrCanvas" class="qrbox"></canvas>
          <div class="row gap">
            <input id="studentLink" class="input grow" readonly />
            <button id="btnCopyLink" class="btn ghost">링크 복사</button>
            <button id="btnOpenStudent" class="btn ghost">학생 모드로 열기</button>
          </div>
        </div>
      </div>
    </section>

    <!-- 프레젠테이션 -->
    <section id="panelPresent" class="card hidden">
      <h3 id="pTitle" class="center muted">-</h3>
      <h1 id="pQ" class="center">대기 중…</h1>
      <div class="legend center">
        <span class="dot ok"></span> 정답자
        <span class="dot no"></span> 오답자
        <span class="dot wait"></span> 미제출
      </div>
      <div id="pOpts" class="choices center"></div>
    </section>

    <!-- 결과 -->
    <section id="panelResults" class="card hidden">
      <div class="row gap">
        <button id="btnExportCSV" class="btn ghost">CSV 내보내기</button>
        <button id="btnResetAll" class="btn danger">전체 초기화</button>
        <button id="btnSaveJSON" class="btn ghost">백업(JSON)</button>
        <input id="fileLoad" type="file" accept="application/json" class="file" />
      </div>
      <div id="resultsTable" class="table-wrap"></div>
    </section>

    <!-- 학생 영역 -->
    <section id="studentPanel" class="card">
      <div class="row gap">
        <input id="studentName" class="input w-240" placeholder="이름" />
        <button id="btnJoin" class="btn primary">참가</button>
        <span id="studentState" class="muted"></span>
      </div>
      <div class="stack gap">
        <div class="row gap">
          <span id="badgeType" class="pill gray">대기</span>
          <span class="muted" id="studentProgress">0/0</span>
        </div>
        <h2 id="sQText">대기 중입니다…</h2>
        <div id="mcqBox" class="choices"></div>
        <div id="shortBox" class="row gap hidden">
          <input id="shortInput" class="input grow" placeholder="답을 입력하세요" />
          <button id="btnShortSend" class="btn primary">제출</button>
        </div>
      </div>
    </section>

    <!-- 가이드 (역할별 노출) -->
    <aside class="grid-2 gap">
      <div id="guideAdmin" class="card">
        <h3>📘 교사용 가이드</h3>
        <ul class="guide">
          <li>세션코드 입력 → <b>접속</b> (다음 접속부터 자동 재접속)</li>
          <li><b>문항 만들기</b>에서 작성 후 <b>저장</b></li>
          <li><b>진행</b> 탭: <b>시작</b> → <b>제출 허용</b> 체크</li>
          <li>정책: 기본 <b>기기당 1회</b>, 필요시 <b>실명당 1회</b></li>
          <li>타이머 + <b>자동 다음</b> 옵션으로 라운드 자동 진행</li>
          <li><b>프레젠테이션</b>: 화면 공유용</li>
          <li><b>결과</b>: 채점/CSV/초기화/백업/불러오기</li>
        </ul>
      </div>
      <div id="guideStudent" class="card">
        <h3>🧑‍🎓 학생 가이드</h3>
        <ul class="guide">
          <li>링크/QR 접속 → 이름 입력 → <b>참가</b></li>
          <li>화면의 보기 버튼 또는 입력 후 <b>제출</b></li>
          <li>실명 1회 제한일 수 있음(선생님 설정)</li>
        </ul>
      </div>
    </aside>
  </main>

  <!-- 앱 로직: ESM -->
  <script type="module" src="./app.js"></script>
</body>
</html>
