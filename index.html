<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>실시간 퀴즈 · 교무</title>

  <style>
    :root{
      --bg:#0f1623; --panel:#141c2b; --card:#101828; --muted:#94a3b8; --text:#e6edf5;
      --pri:#5b6fff; --ok:#19c37d; --warn:#ffb020; --bad:#ff5d5d; --chip:#1b2540;
      --accent:#7c88ff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Noto Sans KR,Malgun Gothic,sans-serif}
    a{color:inherit}
    .wrap{max-width:1200px;margin:0 auto;padding:24px}
    .row{display:flex;gap:12px;align-items:center}
    .col{display:flex;flex-direction:column;gap:12px}
    .panel{background:var(--panel);border:1px solid #1d2740;border-radius:14px;padding:16px}
    .card{background:var(--card);border:1px solid #1b2340;border-radius:12px;padding:14px}
    .grid{display:grid;gap:12px}
    .g2{grid-template-columns:1.2fr .8fr}
    h1{font-size:28px;margin:0 0 8px}
    h2{font-size:18px;margin:0 0 8px;color:#c9d5ff}
    label.small{font-size:12px;color:var(--muted)}
    input,select,textarea{background:#0c1321;border:1px solid #243050;border-radius:10px;color:var(--text);padding:10px 12px;outline:none}
    input:focus,select:focus,textarea:focus{border-color:var(--accent)}
    .btn{border:1px solid #2b3760;background:#111a2f;color:#e6ecff;border-radius:10px;padding:8px 14px;font-weight:600;cursor:pointer}
    .btn:hover{background:#17223a}
    .btn.pri{background:var(--pri);border-color:var(--pri);color:white}
    .btn.ok{background:var(--ok);border-color:var(--ok);color:#04130d}
    .btn.bad{background:#2b0f14;border-color:#531a24;color:#ffd6db}
    .btn.ghost{background:transparent;border-color:#2b385f}
    .tag{background:#1a2240;color:#cfe1ff;border:1px solid #26305a;border-radius:999px;padding:4px 10px;font-size:12px}
    .chip{background:var(--chip);border:1px solid #263661;border-radius:999px;padding:6px 10px;font-size:12px}
    .muted{color:var(--muted)}
    .hidden{display:none!important}
    .table{width:100%;border-collapse:separate;border-spacing:0;overflow:hidden;border-radius:12px;border:1px solid #28345b}
    .table th,.table td{padding:10px 12px;border-bottom:1px solid #22305a;text-align:center}
    .table th{background:#141d31;color:#c8d5ff;font-weight:700}
    .pill{border-radius:999px;padding:2px 8px;font-size:12px;border:1px solid #2a365f;background:#132040}
    .pill.ok{background:#0d2a20;border-color:#234f3d;color:#7fffd1}
    .pill.bad{background:#2a1620;border-color:#5a2c3f;color:#ffd0d0}
    .big{font-size:36px;font-weight:800}
    .qrBox{display:grid;place-items:center;background:#0c1425;border:1px dashed #2a355a;border-radius:12px;height:240px}
    .rightcol{position:sticky;top:12px}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace}
    .help{font-size:12px;color:#a9b6d8;line-height:1.55}
    .help h3{margin:14px 0 6px;font-size:12px;color:#cfe1ff;display:flex;gap:6px;align-items:center}
    .help .icon{font-size:12px}
    .kbd{border:1px solid #2b365f;background:#0f1930;border-radius:6px;padding:0 6px;font-size:11px}
    .present{background:#040a18;border:1px solid #2a355a;border-radius:12px;padding:16px}
    .present h2{font-size:22px}
    .option{border:1px solid #2d3a62;background:#0f1730;color:#dae7ff;border-radius:10px;padding:10px 12px;cursor:pointer}
    .option.selected{border-color:#7f8cff;background:#1b2450}
    .option.correct{border-color:#24e39a;box-shadow:0 0 0 2px #24e39a33 inset}
    .option.wrong{border-color:#ff6b6b;box-shadow:0 0 0 2px #ff6b6b33 inset}
  </style>

  <!-- Firebase (선택) -->
  <script defer src="https://www.gstatic.com/firebasejs/10.12.5/firebase-app-compat.js"></script>
  <script defer src="https://www.gstatic.com/firebasejs/10.12.5/firebase-firestore-compat.js"></script>

  <!-- QR 라이브러리 + 폴백 고려 -->
  <script defer src="https://unpkg.com/qrcode@1.5.3/build/qrcode.min.js"></script>

  <!-- 앱 스크립트 -->
  <script defer src="./app.js"></script>
</head>
<body>
  <div class="wrap">
    <div class="row" style="justify-content:space-between;align-items:flex-end">
      <div>
        <div class="row" style="gap:8px;align-items:center">
          <span class="tag">LIVE</span>
          <span class="muted">세션</span>
          <input id="roomIdInput" class="mono" placeholder="예: classA" style="width:220px" />
          <button id="btnConnect" class="btn pri">접속</button>
          <button id="btnTeacherMode" class="btn">관리자</button>
          <button id="btnStudentMode" class="btn ghost">학생</button>
        </div>
        <h1 style="margin-top:10px">실시간 퀴즈</h1>
        <div id="statusText" class="muted">관리자 모드: 세션을 연결해 주세요.</div>
      </div>

      <div class="help rightcol" style="max-width:420px">
        <h3><span class="icon">📘</span>사용 가이드</h3>
        <div id="guide-teacher">
          <p><span class="icon">1️⃣</span> 세션코드를 입력하고 <span class="kbd">접속</span> → <span class="kbd">문항 만들기</span>에서 문항 작성 후 <span class="kbd">저장</span>.</p>
          <p><span class="icon">2️⃣</span> <span class="kbd">프레젠테이션</span> 열어서 학생들과 공유. <span class="kbd">제출 허용</span>을 켜면 학생 제출 가능.</p>
          <p><span class="icon">3️⃣</span> <span class="kbd">골든벨</span>을 켜면 오답자 자동 탈락. 결과는 <span class="kbd">결과</span> 탭에서 확인/CSV 저장.</p>
        </div>
        <div id="guide-student" class="hidden">
          <p><span class="icon">1️⃣</span> 교사가 알려준 세션 링크/QR로 접속 → 이름 입력 후 <span class="kbd">참가</span>.</p>
          <p><span class="icon">2️⃣</span> 문제 화면에서 답을 고르고 <span class="kbd">제출</span> 버튼!</p>
          <p><span class="icon">3️⃣</span> 골든벨이 켜진 경우 오답 시 탈락(화면에 표시).</p>
        </div>
      </div>
    </div>

    <!-- 탭 (관리자) -->
    <div id="teacherPanel" class="panel" style="margin-top:16px">
      <div class="row">
        <button data-tab="build" class="btn pri tab">문항 만들기</button>
        <button data-tab="control" class="btn ghost tab">진행</button>
        <button data-tab="results" class="btn ghost tab">결과</button>
        <button data-tab="present" class="btn ghost tab">프레젠테이션</button>
        <div class="muted" id="policyText" style="margin-left:auto"></div>
      </div>

      <!-- 문항 만들기 -->
      <section id="tab-build" class="grid g2" style="margin-top:12px">
        <div class="col">
          <div class="card">
            <h2>퀴즈 기본</h2>
            <div class="row">
              <label class="small">제목</label>
              <input id="quizTitle" value="우리 반 실시간 퀴즈" style="flex:1" />
              <label class="small">문항 수</label>
              <input id="questionCount" type="number" min="1" max="20" value="3" style="width:90px" />
              <button id="btnBuildForm" class="btn">빈 폼 만들기</button>
              <button id="btnLoadSample" class="btn ghost">샘플 불러오기</button>
            </div>

            <div class="row">
              <label class="small">제출 정책</label>
              <select id="policySelect">
                <option value="device" selected>기기당 1회</option>
                <option value="name">실명당 1회</option>
              </select>
              <label class="small">골든벨</label>
              <input id="goldenBellToggle" type="checkbox" />
            </div>
          </div>

          <div id="builder" class="col"></div>

          <div class="row">
            <button id="btnSaveQuiz" class="btn pri">저장</button>
            <button id="btnExportJSON" class="btn ghost">JSON 저장</button>
            <input id="fileImport" type="file" accept="application/json" class="hidden" />
            <button id="btnImportJSON" class="btn ghost">불러오기</button>
          </div>
        </div>

        <div class="col">
          <div class="card">
            <h2>학생용 접속 QR</h2>
            <div id="qrBox" class="qrBox"></div>
            <div class="row" style="margin-top:8px">
              <label class="small">링크</label>
              <input id="studentLinkInput" class="mono" style="flex:1" readonly />
              <button id="btnCopy" class="btn">링크 복사</button>
              <a id="btnOpenStudent" class="btn ghost" target="_blank">학생 모드로 열기</a>
            </div>
          </div>
        </div>
      </section>

      <!-- 진행 -->
      <section id="tab-control" class="hidden" style="margin-top:12px">
        <div class="grid g2">
          <div class="card col">
            <div class="row" style="flex-wrap:wrap;gap:8px">
              <button id="btnStart" class="btn pri">시작</button>
              <button id="btnPrev" class="btn">이전</button>
              <button id="btnNext" class="btn">다음</button>
              <label class="row" style="gap:6px"><input id="toggleAccept" type="checkbox" /> 제출 허용</label>
              <label class="row" style="gap:6px"><input id="toggleReveal" type="checkbox" /> 결과 공개</label>
            </div>

            <div class="row" style="gap:20px;margin-top:6px">
              <div>현재: <span id="ctlTitle" class="pill">-</span></div>
              <div>문항: <span id="ctlIdx" class="pill">-</span></div>
              <div>참가: <span id="ctlJoin" class="pill">0</span></div>
            </div>

            <div id="ctlQuestion" class="card" style="min-height:80px"></div>

            <div id="shortGrader" class="card hidden">
              <h2>주관식 채점</h2>
              <div id="shortAnswers" class="col"></div>
            </div>
          </div>

          <div class="card">
            <h2>진행 현황</h2>
            <div class="row" style="flex-wrap:wrap" id="chips"></div>
            <div class="row" style="gap:8px;margin-top:8px">
              <span class="pill ok">정답</span>
              <span class="pill bad">오답</span>
              <span class="pill">미제출</span>
              <span class="pill">탈락</span>
            </div>
          </div>
        </div>
      </section>

      <!-- 결과 -->
      <section id="tab-results" class="hidden" style="margin-top:12px">
        <div class="row" style="gap:8px;margin-bottom:8px">
          <button id="btnExportCSV" class="btn ghost">CSV 내보내기</button>
          <button id="btnResetAll" class="btn bad">전체 초기화</button>
        </div>
        <table class="table" id="resultsTable">
          <thead>
            <tr id="resultsHead"></tr>
          </thead>
          <tbody id="resultsBody"></tbody>
        </table>
      </section>

      <!-- 프레젠테이션 -->
      <section id="tab-present" class="hidden" style="margin-top:12px">
        <div class="present">
          <div class="row" style="justify-content:space-between;align-items:center">
            <h2 id="pptTitle">-</h2>
            <div class="muted" id="pptSub">-</div>
          </div>
          <div id="pptQuestion" style="font-size:22px;margin:12px 0 8px">-</div>
          <div id="pptOptions" class="col"></div>
          <div class="row" style="gap:12px;margin-top:14px">
            <div>제출: <span id="pptSubmit" class="pill">0</span></div>
            <div>정답: <span id="pptOk" class="pill ok">0</span></div>
            <div>오답: <span id="pptBad" class="pill bad">0</span></div>
            <div>탈락: <span id="pptOut" class="pill">0</span></div>
          </div>
        </div>
      </section>
    </div>

    <!-- 학생 -->
    <div id="joinCard" class="panel hidden" style="margin-top:16px">
      <div class="row" style="gap:10px;align-items:flex-end;flex-wrap:wrap">
        <div class="col" style="min-width:240px">
          <label class="small">이름(실명)</label>
          <input id="studentName" placeholder="예: 김하늘" />
        </div>
        <button id="btnJoin" class="btn pri">참가</button>
        <div id="answerState" class="muted"></div>
      </div>

      <div id="studentQuiz" class="col" style="margin-top:14px">
        <div class="row" style="gap:12px;align-items:center">
          <span id="quizTypeBadge" class="tag">대기</span>
          <span id="questionText" class="big">대기 중입니다…</span>
          <span id="progressText" class="muted">0 / 0</span>
        </div>
        <div id="optionsContainer" class="col" style="margin-top:10px"></div>
        <div id="subjectiveBox" class="row hidden" style="gap:8px;margin-top:10px">
          <input id="subjectiveInput" placeholder="정답 입력" style="flex:1" />
          <button id="btnSubmitSubjective" class="btn pri">제출</button>
        </div>
        <div class="row" style="gap:8px;margin-top:10px">
          <button id="btnSubmitMCQ" class="btn pri hidden">선택 제출</button>
        </div>
      </div>
    </div>
  </div>
</body>
</html>
