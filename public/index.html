<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>실시간 퀴즈 (교무)</title>
  <meta name="color-scheme" content="dark" />
  <link rel="stylesheet" href="../src/styles.css" />
</head>
<body>
  <div class="wrap">
    <header>
      <span class="dot"></span><h1>실시간 퀴즈</h1>
      <span class="pill" id="liveState">대기</span>
    </header>

    <!-- 접속 바 -->
    <div class="bar">
      <span class="badge">세션 코드</span>
      <input id="roomIdInput" placeholder="예: classA" style="width:200px">
      <button class="btn p sm" id="btnConnect">접속</button>
      <button class="btn o sm" id="btnTeacherMode">관리자</button>
      <button class="btn o sm" id="btnStudentMode">학생</button>
      <span class="subtle" id="statusText">세션에 접속해 주세요.</span>
    </div>

    <!-- 메인 그리드 -->
    <div class="grid two" style="margin-top:16px">

      <!-- 좌: 본 패널 -->
      <div>
        <!-- 학생 Join -->
        <div id="joinCard" class="card">
          <div class="row" style="justify-content:space-between">
            <div>
              <div class="badge">학생 참여</div>
              <div class="muted mini">세션 접속 후 이름을 입력하고 참가하세요.</div>
            </div>
          </div>
          <div class="row" style="margin-top:10px;gap:10px">
            <input id="studentName" placeholder="이름" style="width:200px">
            <button class="btn g sm" id="btnJoin">참가</button>
          </div>
        </div>

        <!-- 학생 퀴즈 -->
        <div id="studentQuiz" class="card hidden">
          <div class="row" style="justify-content:space-between">
            <div class="row" style="gap:8px">
              <span class="badge" id="quizTypeBadge">대기</span>
              <span class="pill">진행 <b id="progressText">0 / 0</b></span>
            </div>
            <div class="muted mini" id="answerState"></div>
          </div>

          <h3 id="questionText" style="margin:10px 0 12px">대기 중입니다…</h3>
          <div class="grid" id="optionsContainer" style="gap:8px"></div>

          <div id="subjectiveBox" class="hidden" style="margin-top:10px">
            <div class="row" style="gap:8px">
              <input id="subjectiveInput" placeholder="정답을 입력하세요" style="flex:1">
              <button class="btn p sm" id="btnSubmitSubjective">제출</button>
            </div>
          </div>
        </div>

        <!-- 관리자 패널 -->
        <div id="teacherPanel" class="card hidden">
          <div class="row" style="justify-content:space-between;align-items:flex-end">
            <div>
              <div class="badge">관리자 모드</div>
              <div class="muted mini" id="roomInfo">세션 연결 필요</div>
            </div>
            <div class="tabs row">
              <div class="tab active" data-tab="build">문항 만들기</div>
              <div class="tab" data-tab="control">진행</div>
              <div class="tab" data-tab="results">결과</div>
            </div>
          </div>

          <!-- Build -->
          <section id="tab-build" style="margin-top:14px">
            <div class="row" style="gap:10px;flex-wrap:wrap">
              <input id="quizTitle" placeholder="퀴즈 제목" style="width:260px">
              <span class="row" style="gap:6px"><label class="muted mini">문항 수</label><input id="questionCount" type="number" value="3" min="1" max="20" style="width:90px"></span>
              <button class="btn sm o" id="btnBuildForm">빈 폼 만들기</button>
              <button class="btn sm o" id="btnLoadSample">샘플 불러오기</button>
              <button class="btn sm p" id="btnSaveQuiz">퀴즈 저장</button>
              <button class="btn sm ghost" id="btnLoadJSON">불러오기</button>
              <button class="btn sm ghost" id="btnSaveJSON">JSON 저장</button>
            </div>
            <div id="builder" class="grid" style="margin-top:12px"></div>
          </section>

          <!-- Control -->
          <section id="tab-control" class="hidden" style="margin-top:14px">
            <div class="grid two">
              <div class="card">
                <div class="row" style="gap:8px;flex-wrap:wrap">
                  <button class="btn p" id="btnStart">시작</button>
                  <button class="btn o" id="btnPrev">이전</button>
                  <button class="btn o" id="btnNext">다음</button>
                  <button class="btn d" id="btnStop">마감</button>

                  <label class="switch"><input type="checkbox" id="toggleAccept"><span>제출 허용</span></label>
                  <label class="switch"><input type="checkbox" id="toggleReveal"><span>결과 공개</span></label>
                  <label class="switch"><input type="checkbox" id="toggleBell"><span>골든벨</span></label>
                </div>

                <div class="hr"></div>

                <div class="row" style="gap:14px;flex-wrap:wrap">
                  <span class="badge">타이머(초)</span>
                  <input id="timerSec" type="number" value="30" min="5" max="600" style="width:90px">
                  <button class="btn w sm" id="btnTimerStart">타이머 시작</button>
                  <button class="btn ghost sm" id="btnTimerStop">타이머 정지</button>
                  <span class="pill">남은 시간 <b id="leftTime">00:00</b></span>
                  <span class="muted">현재: <b id="ctlQuestion">-</b></span>
                </div>

                <div class="hr"></div>

                <div>
                  <div class="muted mini">정답/탈락 현황</div>
                  <div id="chips" class="list" style="margin-top:8px"></div>
                </div>

                <div id="shortGrader" class="hidden" style="margin-top:12px">
                  <div class="muted mini">주관식 채점</div>
                  <div id="shortAnswers" class="grid" style="margin-top:6px;gap:6px"></div>
                </div>
              </div>

              <div class="card">
                <div class="muted mini">학생용 접속 QR</div>
                <div class="qrbox" style="margin-top:8px">
                  <div class="qr" id="qrBox"><div id="qr"></div></div>
                  <div style="flex:1">
                    <div class="muted mini">링크</div>
                    <input id="studentLink" readonly style="width:100%;margin:6px 0">
                    <div class="row" style="gap:8px">
                      <button class="btn o sm" id="btnCopy">링크 복사</button>
                      <button class="btn sm ghost" id="btnOpenStudent">학생 모드로 열기</button>
                    </div>
                    <p class="rightNote">QR/링크는 <b>세션 코드</b>와 현재 설정을 반영합니다.</p>
                  </div>
                </div>
              </div>
            </div>
          </section>

          <!-- Results -->
          <section id="tab-results" class="hidden" style="margin-top:14px">
            <div class="row" style="gap:8px;flex-wrap:wrap">
              <button class="btn sm o" id="btnExportCSV">CSV 내보내기</button>
              <button class="btn sm d" id="btnResetRoom">전체 초기화</button>
            </div>
            <div id="resultsContainer" style="margin-top:12px" class="card"></div>
          </section>
        </div>
      </div>

      <!-- 우: 도움말 -->
      <aside class="card">
        <div id="help-teacher" class="help">
          <h3>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="#9fc1ff" style="vertical-align:-2px;margin-right:6px"><path d="M3 5a2 2 0 0 1 2-2h11a3 3 0 0 1 3 3v11a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2V5Z"/><path d="M19 17V6a2 2 0 0 0-2-2H7"/></svg>
            관리자 모드 사용법
          </h3>
          <ul>
            <li>세션 코드 입력 → <b>접속</b></li>
            <li><b>문항 만들기</b>에서 객관식/주관식 작성 → <b>퀴즈 저장</b></li>
            <li><b>진행</b> 탭에서 <b>시작</b>, <b>제출 허용</b> 토글</li>
            <li><b>골든벨</b>: 공개 시 오답 자동 탈락</li>
            <li>결과는 <b>JSON/CSV</b>로 저장 가능</li>
          </ul>
          <div class="hr"></div>
          <h3>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="#ffd36b" style="vertical-align:-2px;margin-right:6px"><path d="M9 18h6v2a2 2 0 0 1-2 2h-2a2 2 0 0 1-2-2v-2Z"/><path d="M8 14a6 6 0 1 1 8 0l-1 1v1H9v-1l-1-1Z"/></svg>
            팁
          </h3>
          <ul>
            <li>타이머는 문제 시작 직후 켜면 집중도 UP</li>
            <li>주관식은 정답 텍스트를 쓰면 자동채점</li>
            <li>QR/링크는 접속 후 자동 생성됩니다</li>
          </ul>
        </div>

        <div id="help-student" class="help hidden">
          <h3>
            <svg width="14" height="14" viewBox="0 0 24 24" fill="#91e3c0" style="vertical-align:-2px;margin-right:6px"><path d="M12 12a5 5 0 1 0-5-5 5 5 0 0 0 5 5Z"/><path d="M4 20a8 8 0 0 1 16 0Z"/></svg>
            학생 사용법
          </h3>
          <ul>
            <li>세션 코드 입력 → <b>접속</b> → 이름 → <b>참가</b></li>
            <li>객관식: 보기 클릭 / 주관식: 입력 후 <b>제출</b></li>
            <li>교사가 <b>제출 허용</b>을 켰을 때만 제출돼요</li>
          </ul>
        </div>
      </aside>
    </div>
  </div>

  <!-- QRCodeJS (window.QRCode) -->
  <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.min.js"></script>

  <!-- 앱 스크립트 (Firebase 모듈 import 포함) -->
  <script type="module" src="../src/app.js"></script>
</body>
</html>
